const categoriesObj = {
  "Всё для татуировки": {
    Аксессуары: {
      "Для мастеров": [
        {
          Название: "Искусственная кожа глаза 260х150 мм 2 мм желтая 3D",
          Цена: "170",
          Изображение: "/assets/skineye.jpg",
        },
        {
          Название: "Искусственная кожа брови 260х150 мм 2 мм желтая 3D",
          Цена: "170",
          Изображение: "/assets/skinbrow.jpg",
        },
        {
          Название: "Бокс для очистки игл стерильный - 18 шт/уп",
          Цена: "900",
          Изображение: "/assets/cleanbox.jpg",
        },
        {
          Название: "Кристаллы сгущающие жидкость Tattoo Revive Jelly 212 гр",
          Цена: "900",
          Изображение: "/assets/cryst.jpg",
        },
        {
          Название: "Контейнер для острого инструмента класса А с крышкой",
          Цена: "150",
          Изображение: "/assets/sharpbox.jpg",
        },
        {
          Название: "Линейка для перманентного макияжа бровей - 10 шт",
          Цена: "650",
          Изображение: "/assets/ruler.jpg",
        },
        {
          Название: "Подставка под картриджи и краску - 20 шт",
          Цена: "400",
          Изображение: "/assets/tray.jpg",
        },
        {
          Название: "Искусственная кожа лицо желтая 3D",
          Цена: "170",
          Изображение: "/assets/skinface.jpg",
        },
        {
          Название: "Искусственная кожа губы 260х150 мм 2 мм желтая 3D",
          Цена: "170",
          Изображение: "/assets/skinlips.jpg",
        },
      ],
    },
    "Вазелин и масла": {
      Druid: [
        {
          Название: "Масло для татуировок Druid - Spring Series Лимон 250 мл",
          Цена: "800",
          Изображение: "/assets/spring.jpg",
        },
        {
          Название: "Масло для татуировок Druid - Summer Series Баблгам 250 мл",
          Цена: "800",
          Изображение: "/assets/summer.jpg",
        },
        {
          Название: "Масло для татуировок Druid - Autumn Series Вишня 250 мл",
          Цена: "800",
          Изображение: "/assets/autumn.jpg",
        },
        {
          Название:
            "Масло для татуировок Druid - Winter Series Имбирный пряник 250 мл",
          Цена: "800",
          Изображение: "/assets/winter.jpg",
        },
        {
          Название: "Медиагель 5 л",
          Цена: "1000",
          Изображение: "/assets/gel.jpg",
        },
      ],
      TattooRevive: [
        {
          Название: "Гель для татуируемой кожи Tattoo Revive OIL 350 мл",
          Цена: "595",
          Изображение: "/assets/revive.jpg",
        },
      ],
    },
    "Всё для ухода и заживления": {
      TattooRevive: [
        {
          Название:
            "Гель для ухода за татуированной кожей Tattoo Revive OLASTIC 5 мл",
          Цена: "80",
          Изображение: "/assets/revgel.jpg",
        },
        {
          Название:
            "Гель для ухода за татуированной кожей Tattoo Revive OLASTIC 30 мл",
          Цена: "425",
          Изображение: "/assets/revolastic.jpg",
        },
        {
          Название: "Крем для ухода за татуировкой Tattoo Revive Cream 40 мл",
          Цена: "425",
          Изображение: "/assets/revcream.jpg",
        },
        {
          Название:
            "Обезжиривающий спрей для обработки кожи Tattoo Revive Spray 30 мл",
          Цена: "295",
          Изображение: "/assets/revspray.jpg",
        },
        {
          Название:
            "Пленка для заживления татуировки Protective Tattoo Revive Film 10 см х 1 м",
          Цена: "600",
          Изображение: "/assets/revfilm.jpg",
        },
      ],
      "Suprasorb F": [
        {
          Название:
            "Пленка для заживления Супрасорб Ф (Suprasorb F) 20 см х 30 см - 1 шт",
          Цена: "450",
          Изображение: "/assets/suprasorb2030.jpg",
        },
        {
          Название:
            "Пленка для заживления Супрасорб Ф (Suprasorb F) 15 см х 10 м",
          Цена: "4300",
          Изображение: "/assets/suprasorb1510.jpg",
        },
      ],
      Druid: [
        {
          Название: "Бальзам для ухода за татуировкой Druid 30 мл",
          Цена: "350",
          Изображение: "/assets/druidbalm.jpg",
        },
      ],
      "A&D": [
        {
          Название:
            "Гель для ухода за татуированной кожей, перманентом бровей и губ A&D Ointment 5 г",
          Цена: "50",
          Изображение: "/assets/gelad.jpg",
        },
      ],
      "Ez Tattoo": [
        {
          Название: "Пленка для заживления татуировки - EZ tattoo 10см х 10м",
          Цена: "1200",
          Изображение: "/assets/ezfilm.jpg",
        },
      ],
    },
    "Иглы и типсы для татуировки": {},
    "Краска для татуировки": {
      "Allegory Ink": [
        {
          Название: "Краска для тату Allegory BLAK - Черный пигмент",
          Цена: "680",
          Изображение: "/assets/allegory1.jpg",
        },
        {
          Название: "Краска для тату Allegory WHITE - Белый пигмент",
          Цена: "680",
          Изображение: "/assets/allegory2.jpg",
        },
      ],
      "Eternal Ink": [],
      Intenze: [],
      Nocturnal: [
        {
          Название: "Набор красок для тату Nocturnal West Coast Blend - 3 шт",
          Цена: "2000",
          Изображение: "/assets/nocturnal.jpg",
        },
        {
          Название: "Краска для тату Nocturnal Shine White",
          Цена: "890",
          Изображение: "/assets/nocturnal1.jpg",
        },
        {
          Название: "Краска для тату Nocturnal Super Black",
          Цена: "890",
          Изображение: "/assets/nocturnal2.jpg",
        },
      ],
      "World Famous": [],
    },
    "Мыло и пенка": {},
    "Тату машинки": {},
  },

  "Всё для пирсинга": {
    "Инструменты для пирсинга": {},
    "Подставки под украшения": {},
    Украшения: {},
  },
  "Всё для студии": {
    "Дезинфекция и стерилизация": {},
    Лампы: {},
    Расходники: {},
  },
};

exports.seed = async function (knex) {
  // Truncate tables to reset auto-increment counters
  await knex.raw("TRUNCATE TABLE products RESTART IDENTITY CASCADE");
  await knex.raw("TRUNCATE TABLE categories RESTART IDENTITY CASCADE");

  async function processCategories(categories, parentId = null) {
    for (const [name, childrenOrProducts] of Object.entries(categories)) {
      // Insert category
      const [category] = await knex("categories")
        .insert({
          name,
          parent_id: parentId,
          created_at: new Date(),
          updated_at: new Date(),
        })
        .returning("id");

      // Check if current category has products (array) or subcategories (object)
      if (Array.isArray(childrenOrProducts)) {
        // Insert products if array is not empty
        if (childrenOrProducts.length > 0) {
          const products = childrenOrProducts.map((product) => ({
            title: product.Название,
            price: parseFloat(product.Цена),
            image: product.Изображение,
            category_id: category.id,
            created_at: new Date(),
            updated_at: new Date(),
          }));
          await knex("products").insert(products);
        }
      } else {
        // Process subcategories recursively
        await processCategories(childrenOrProducts, category.id);
      }
    }
  }

  // Start processing from root categories
  await processCategories(categoriesObj);
};
